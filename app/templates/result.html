<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>分析结果 - 教学流程图智能批阅系统</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        .score-card {
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .score-value {
            font-size: 3rem;
            font-weight: bold;
        }
        .score-label {
            font-size: 1.2rem;
            color: #666;
        }
        .score-high {
            background-color: #d4edda;
            color: #155724;
        }
        .score-medium {
            background-color: #fff3cd;
            color: #856404;
        }
        .score-low {
            background-color: #f8d7da;
            color: #721c24;
        }
        .feedback-section {
            margin-top: 20px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        .suggestion-item {
            margin-bottom: 10px;
            padding: 10px;
            background-color: #e9ecef;
            border-radius: 5px;
        }
        .image-container {
            text-align: center;
            margin: 20px 0;
        }
        .image-container img {
            max-width: 100%;
            max-height: 500px;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="/">教学流程图智能批阅系统</a>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="col-md-12">
                <div class="card mb-4">
                    <div class="card-header">
                        <h3>分析结果</h3>
                    </div>
                    <div class="card-body">
                        <div class="image-container">
                            <img src="{{ url_for('static', filename=image_path) }}" alt="流程图" class="img-fluid">
                        </div>
                        
                        {% if vis_image_path %}
                        <div class="image-container mt-4">
                            <h4>识别结果可视化</h4>
                            <img src="{{ url_for('static', filename=vis_image_path) }}" alt="识别结果可视化" class="img-fluid">
                        </div>
                        {% endif %}
                        
                        <!-- 识别详情 -->
                        <div class="row mt-4">
                            <div class="col-md-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>识别详情</h5>
                                        <ul class="nav nav-tabs card-header-tabs" id="recognitionTabs" role="tablist">
                                            <li class="nav-item" role="presentation">
                                                <button class="nav-link active" id="shapes-tab" data-bs-toggle="tab" data-bs-target="#shapes" type="button" role="tab" aria-controls="shapes" aria-selected="true">图形 ({{ shapes|length }})</button>
                                            </li>
                                            <li class="nav-item" role="presentation">
                                                <button class="nav-link" id="texts-tab" data-bs-toggle="tab" data-bs-target="#texts" type="button" role="tab" aria-controls="texts" aria-selected="false">文本 ({{ text_regions|length }})</button>
                                            </li>
                                            <li class="nav-item" role="presentation">
                                                <button class="nav-link" id="nodes-tab" data-bs-toggle="tab" data-bs-target="#nodes" type="button" role="tab" aria-controls="nodes" aria-selected="false">节点 ({{ nodes|length }})</button>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="card-body">
                                        <div class="tab-content" id="recognitionTabsContent">
                                            <!-- 图形信息 -->
                                            <div class="tab-pane fade show active" id="shapes" role="tabpanel" aria-labelledby="shapes-tab">
                                                <div class="table-responsive">
                                                    <table class="table table-striped table-hover">
                                                        <thead>
                                                            <tr>
                                                                <th>#</th>
                                                                <th>类型</th>
                                                                <th>位置 (x, y)</th>
                                                                <th>尺寸 (w, h)</th>
                                                                <th>面积</th>
                                                                <th>关联文本</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            {% for shape in shapes %}
                                                            <tr>
                                                                <td>{{ loop.index }}</td>
                                                                <td>{{ shape.type }}</td>
                                                                <td>({{ shape.position.x }}, {{ shape.position.y }})</td>
                                                                <td>({{ shape.bbox[2] }}, {{ shape.bbox[3] }})</td>
                                                                <td>{{ shape.area|int }}</td>
                                                                <td>{{ shape.text }}</td>
                                                            </tr>
                                                            {% endfor %}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                            
                                            <!-- 文本信息 -->
                                            <div class="tab-pane fade" id="texts" role="tabpanel" aria-labelledby="texts-tab">
                                                <div class="table-responsive">
                                                    <table class="table table-striped table-hover">
                                                        <thead>
                                                            <tr>
                                                                <th>#</th>
                                                                <th>文本内容</th>
                                                                <th>位置 (x, y)</th>
                                                                <th>尺寸 (w, h)</th>
                                                                {% if text_regions and text_regions[0].confidence is defined %}
                                                                <th>置信度</th>
                                                                {% endif %}
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            {% for text in text_regions %}
                                                            <tr>
                                                                <td>{{ loop.index }}</td>
                                                                <td>{{ text.text }}</td>
                                                                <td>({{ text.position.x }}, {{ text.position.y }})</td>
                                                                <td>({{ text.bbox[2] }}, {{ text.bbox[3] }})</td>
                                                                {% if text.confidence is defined %}
                                                                <td>{{ "%.2f"|format(text.confidence) }}</td>
                                                                {% endif %}
                                                            </tr>
                                                            {% endfor %}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                            
                                            <!-- 节点信息 -->
                                            <div class="tab-pane fade" id="nodes" role="tabpanel" aria-labelledby="nodes-tab">
                                                <div class="table-responsive">
                                                    <table class="table table-striped table-hover">
                                                        <thead>
                                                            <tr>
                                                                <th>ID</th>
                                                                <th>类型</th>
                                                                <th>文本</th>
                                                                <th>位置 (x, y)</th>
                                                                <th>连接到</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            {% for node in nodes %}
                                                            <tr>
                                                                <td>{{ node.id }}</td>
                                                                <td>{{ node.type }}</td>
                                                                <td>{{ node.text }}</td>
                                                                <td>({{ node.position.x }}, {{ node.position.y }})</td>
                                                                <td>
                                                                    {% if node.connections %}
                                                                        {{ node.connections|join(', ') }}
                                                                    {% else %}
                                                                        无
                                                                    {% endif %}
                                                                </td>
                                                            </tr>
                                                            {% endfor %}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <!-- 总分 -->
                            <div class="col-md-4 offset-md-4">
                                <div class="score-card 
                                    {% if result.scores.总分 >= 80 %}score-high
                                    {% elif result.scores.总分 >= 60 %}score-medium
                                    {% else %}score-low{% endif %}">
                                    <div class="score-value">{{ result.scores.总分 if result.scores.总分 is defined else 0 }}</div>
                                    <div class="score-label">总分</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <!-- 各项评分 -->
                            <div class="col-md-3">
                                <div class="score-card 
                                    {% if result.scores.逻辑性 >= 8 %}score-high
                                    {% elif result.scores.逻辑性 >= 6 %}score-medium
                                    {% else %}score-low{% endif %}">
                                    <div class="score-value">{{ result.scores.逻辑性 if result.scores.逻辑性 is defined else 0 }}</div>
                                    <div class="score-label">逻辑性</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="score-card 
                                    {% if result.scores.合理性 >= 8 %}score-high
                                    {% elif result.scores.合理性 >= 6 %}score-medium
                                    {% else %}score-low{% endif %}">
                                    <div class="score-value">{{ result.scores.合理性 if result.scores.合理性 is defined else 0 }}</div>
                                    <div class="score-label">合理性</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="score-card 
                                    {% if result.scores.清晰度 >= 8 %}score-high
                                    {% elif result.scores.清晰度 >= 6 %}score-medium
                                    {% else %}score-low{% endif %}">
                                    <div class="score-value">{{ result.scores.清晰度 if result.scores.清晰度 is defined else 0 }}</div>
                                    <div class="score-label">清晰度</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="score-card 
                                    {% if result.scores.创新性 >= 8 %}score-high
                                    {% elif result.scores.创新性 >= 6 %}score-medium
                                    {% else %}score-low{% endif %}">
                                    <div class="score-value">{{ result.scores.创新性 if result.scores.创新性 is defined else 0 }}</div>
                                    <div class="score-label">创新性</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 统计信息 -->
                        <div class="row mt-4">
                            <div class="col-md-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>流程图统计</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <p><strong>总节点数：</strong> {{ result.statistics.total_nodes if result.statistics.total_nodes is defined else 0 }}</p>
                                                <p><strong>符合规范：</strong> 
                                                    {% if result.符合规范 is defined and result.符合规范 %}
                                                        <span class="badge bg-success">是</span>
                                                    {% else %}
                                                        <span class="badge bg-danger">否</span>
                                                    {% endif %}
                                                </p>
                                            </div>
                                            <div class="col-md-6">
                                                <p><strong>节点类型统计：</strong></p>
                                                <ul>
                                                    {% if result.statistics.node_types is defined %}
                                                        {% for type, count in result.statistics.node_types.items() %}
                                                            <li>{{ type }}: {{ count }}</li>
                                                        {% endfor %}
                                                    {% else %}
                                                        <li>无数据</li>
                                                    {% endif %}
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 反馈意见 -->
                        <div class="feedback-section mt-4">
                            <h4>评价反馈</h4>
                            <div class="card mb-3">
                                <div class="card-body">
                                    <p>{{ result.feedback if result.feedback is defined else '无反馈意见' }}</p>
                                </div>
                            </div>
                            
                            {% if result.改进建议 is defined and result.改进建议|length > 0 %}
                                <h4>改进建议</h4>
                                <div class="list-group">
                                    {% for suggestion in result.改进建议 %}
                                        <div class="suggestion-item">
                                            <i class="bi bi-lightbulb"></i> {{ suggestion }}
                                        </div>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="text-center mt-4">
                            <a href="/" class="btn btn-primary btn-lg">返回首页</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-light py-4 mt-5">
        <div class="container text-center">
            <p>© 2023 教学流程图智能批阅系统 | 基于计算机视觉和人工智能技术</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html> 